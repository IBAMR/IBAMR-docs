<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SAMRAI: SAMRAI::tbox::AsyncCommStage Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li id="current"><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="namespaceSAMRAI.html">SAMRAI</a>::<a class="el" href="namespaceSAMRAI_1_1tbox.html">tbox</a>::<a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html">AsyncCommStage</a></div>
<h1>SAMRAI::tbox::AsyncCommStage Class Reference</h1><!-- doxytag: class="SAMRAI::tbox::AsyncCommStage" -->Stage multiple asynchronous group communications so that the collective can advance asynchronously (as individual underlying MPI requests are completed).  
<a href="#_details">More...</a>
<p>
<code>#include &lt;source/toolbox/parallel/AsyncCommStage.h&gt;</code>
<p>
<a href="classSAMRAI_1_1tbox_1_1AsyncCommStage-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a884da88737394f38ce4a2a852da197b">AsyncCommStage</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Construct a stage that may begin allocating and managing groups.  <a href="#a884da88737394f38ce4a2a852da197b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#b271225de9cef4d8e8b307ff02d503f5">~AsyncCommStage</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deallocate groups remaining in the stage and all internal data used to manage groups.  <a href="#b271225de9cef4d8e8b307ff02d503f5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#7ac1ac75e412cb13835645ed0c5d180f">allocateCommGroup</a> (int nchild, <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> *handle=NULL)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate a group in this stage.  <a href="#7ac1ac75e412cb13835645ed0c5d180f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#874d19e31ce21f59b2ea19a59098f8de">advanceAny</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Advance to completion one group (any group) that is currently waiting for communication to complete.  <a href="#874d19e31ce21f59b2ea19a59098f8de"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#f391c2042139cfb8434f410dad408bc9">advanceSome</a> (<a class="el" href="classSAMRAI_1_1tbox_1_1Array.html">Array</a>&lt; <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> * &gt; &amp;completed)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Advance to completion one or more groups (any groups) that are currently waiting for communication to complete.  <a href="#f391c2042139cfb8434f410dad408bc9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#2557ced47070e760d0f03043bd790d36">isDone</a> () const</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return whether the stage is done with all requested communications.  <a href="#2557ced47070e760d0f03043bd790d36"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#98c4893f9351936139838123bcbcd946">numberOfOutstandingGroups</a> () const</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the number of allocated groups that have pending communication.  <a href="#98c4893f9351936139838123bcbcd946"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#7635f46234290cf35d07bb9981ff079c">numberOfOutstandingRequests</a> () const</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the number of pending <a class="el" href="structSAMRAI_1_1tbox_1_1SAMRAI__MPI.html#1a1dfc2524fba2aac4dcceea5a793622">SAMRAI_MPI::request</a> objects.  <a href="#7635f46234290cf35d07bb9981ff079c"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Friends</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#bd8193bd78625cb42940385c4982c7b5">StagedGroup</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Stage multiple asynchronous group communications so that the collective can advance asynchronously (as individual underlying MPI requests are completed). 
<p>
Use this class when you<ul>
<li>Have multiple group communications, each performed by a different <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> object.</li><li>Want the multiple communications to proceed independently and asynchronously.</li></ul>
<p>
This class allocates a set of <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> objects and manages the space for their <a class="el" href="structSAMRAI_1_1tbox_1_1SAMRAI__MPI.html#1a1dfc2524fba2aac4dcceea5a793622">SAMRAI_MPI::request</a>'s. The requests are staged such that a single MPI_Waitany or MPI_Waitsome call applies to all communication groups allocated by the stage. Thus the communications performed by the <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> objects can complete in the order allowed by the MPI messages. The exact order is NOT deterministic!<p>
To advance the communication operation of any of the allocated <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> objects, use <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#874d19e31ce21f59b2ea19a59098f8de">advanceAny()</a> or <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#f391c2042139cfb8434f410dad408bc9">advanceSome()</a>. In general, <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#f391c2042139cfb8434f410dad408bc9">advanceSome()</a> has better performance than <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#874d19e31ce21f59b2ea19a59098f8de">advanceAny()</a> because it gets around the "starvation" problem. See the MPI documentation for a discussion of starvation.<p>
This class supports communication and uses MPI for message passing. If MPI is disabled, the job of this class disappears and the class is effectively empty, except for allocating and deallocating <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> objects. The public interfaces still remain so the class can compile, but the implementations are trivial. 
<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a884da88737394f38ce4a2a852da197b"></a><!-- doxytag: member="SAMRAI::tbox::AsyncCommStage::AsyncCommStage" ref="a884da88737394f38ce4a2a852da197b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SAMRAI::tbox::AsyncCommStage::AsyncCommStage           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Construct a stage that may begin allocating and managing groups. 
<p>

</div>
</div><p>
<a class="anchor" name="b271225de9cef4d8e8b307ff02d503f5"></a><!-- doxytag: member="SAMRAI::tbox::AsyncCommStage::~AsyncCommStage" ref="b271225de9cef4d8e8b307ff02d503f5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SAMRAI::tbox::AsyncCommStage::~AsyncCommStage           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Deallocate groups remaining in the stage and all internal data used to manage groups. 
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="7ac1ac75e412cb13835645ed0c5d180f"></a><!-- doxytag: member="SAMRAI::tbox::AsyncCommStage::allocateCommGroup" ref="7ac1ac75e412cb13835645ed0c5d180f" args="(int nchild, RelaunchableJob *handle=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> * SAMRAI::tbox::AsyncCommStage::allocateCommGroup           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nchild</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> *&nbsp;</td>
          <td class="paramname"> <em>handle</em> = <code>NULL</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Allocate a group in this stage. 
<p>
You may specify a handle associated with the allocated group and pointing back to an object. These pointers are returned when their group communications are completed by the stage methods <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#874d19e31ce21f59b2ea19a59098f8de">advanceAny()</a> or <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#f391c2042139cfb8434f410dad408bc9">advanceSome()</a>. They help identify the user object waiting for the communication to complete.<p>
To use the handle, create a user class inheritting from <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> so that any handle can be dynamically casted back to the user class.<p>
Usage outline:<ol type=1>
<li>Derive class UserClass from <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a>. Implement the pure virtual interfaces therein.</li><li>Associate a UserClass object with a <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> object by using the address of the UserClass object to allocate the group. See <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#7ac1ac75e412cb13835645ed0c5d180f">AsyncCommStage::allocateCommGroup()</a>.</li><li>Use the allocated group to initiate a group communication.</li><li>Repeat the above for any number of user objects.</li><li>Determine the specific user object associated with the communication completed by <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#874d19e31ce21f59b2ea19a59098f8de">AsyncCommStage::advanceAny()</a> and <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#f391c2042139cfb8434f410dad408bc9">AsyncCommStage::advanceSome()</a> by dynamically casting the output <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> pointer to pointers to UserClass objects.</li></ol>
<p>
Usage example: <div class="fragment"><pre class="fragment">
    * class UserClass : RelaunchableJob { ... };
    * UserClass user_object[10];
    * AsyncCommStage stage;
    * for ( i=0; i&lt;10; ++i ) {
    *    AsyncCommGroup *group =
    *      stage.allocateCommGroup( 2, &amp;user_object[i] );
    *    useGroupToInitiateCommunication(group);
    * }
    * RelaunchableJob *handle = stage.advanceAny();
    * UserClass *completed_user_object = dynamic_cast&lt;UserClass*&gt;(handle);
    * </pre></div><p>
Allocating a group with a NULL handle works, but you lose the ability to map a specific communication back to a user object. See <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#874d19e31ce21f59b2ea19a59098f8de">advanceAny()</a> and <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#f391c2042139cfb8434f410dad408bc9">advanceSome()</a>.<p>
An allocated group should be deallocated using the delete operator when no longer needed. All allocated groups will be deleted when the stage goes out of scope. Since it is an error to delete a group that has pending message requests, it is also an error to delete a stage that has groups with pending message requests.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nchild</em>&nbsp;</td><td>Number of child branches per tree node (see <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a>). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>handle</em>&nbsp;</td><td>Optional pointer back to a user object associated with the group. See class documentation. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="874d19e31ce21f59b2ea19a59098f8de"></a><!-- doxytag: member="SAMRAI::tbox::AsyncCommStage::advanceAny" ref="874d19e31ce21f59b2ea19a59098f8de" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> * SAMRAI::tbox::AsyncCommStage::advanceAny           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Advance to completion one group (any group) that is currently waiting for communication to complete. 
<p>
This method uses MPI_Waitany, which may be prone to starvation. It is better to use <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#f391c2042139cfb8434f410dad408bc9">advanceSome()</a>, which uses MPI_Waitsome, which avoids starvation.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> pointer used to construct the group that is completed. NULL if no group in the stage had incomplete communication. </dd></dl>

</div>
</div><p>
<a class="anchor" name="f391c2042139cfb8434f410dad408bc9"></a><!-- doxytag: member="SAMRAI::tbox::AsyncCommStage::advanceSome" ref="f391c2042139cfb8434f410dad408bc9" args="(Array&lt; RelaunchableJob * &gt; &amp;completed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SAMRAI::tbox::AsyncCommStage::advanceSome           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classSAMRAI_1_1tbox_1_1Array.html">Array</a>&lt; <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> * &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>completed</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Advance to completion one or more groups (any groups) that are currently waiting for communication to complete. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>completed</em>&nbsp;</td><td><a class="el" href="classSAMRAI_1_1tbox_1_1Array.html">Array</a> space to put handleegies associated with the completed communications.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>number of groups completed or 0 if none have outstanding communication. The strategy pointers corresponding to the completed groups are set in the <code>completed</code> array. </dd></dl>

</div>
</div><p>
<a class="anchor" name="2557ced47070e760d0f03043bd790d36"></a><!-- doxytag: member="SAMRAI::tbox::AsyncCommStage::isDone" ref="2557ced47070e760d0f03043bd790d36" args="() const" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SAMRAI::tbox::AsyncCommStage::isDone           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return whether the stage is done with all requested communications. 
<p>

</div>
</div><p>
<a class="anchor" name="98c4893f9351936139838123bcbcd946"></a><!-- doxytag: member="SAMRAI::tbox::AsyncCommStage::numberOfOutstandingGroups" ref="98c4893f9351936139838123bcbcd946" args="() const" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SAMRAI::tbox::AsyncCommStage::numberOfOutstandingGroups           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return the number of allocated groups that have pending communication. 
<p>

</div>
</div><p>
<a class="anchor" name="7635f46234290cf35d07bb9981ff079c"></a><!-- doxytag: member="SAMRAI::tbox::AsyncCommStage::numberOfOutstandingRequests" ref="7635f46234290cf35d07bb9981ff079c" args="() const" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SAMRAI::tbox::AsyncCommStage::numberOfOutstandingRequests           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return the number of pending <a class="el" href="structSAMRAI_1_1tbox_1_1SAMRAI__MPI.html#1a1dfc2524fba2aac4dcceea5a793622">SAMRAI_MPI::request</a> objects. 
<p>

</div>
</div><p>
<hr><h2>Friends And Related Function Documentation</h2>
<a class="anchor" name="bd8193bd78625cb42940385c4982c7b5"></a><!-- doxytag: member="SAMRAI::tbox::AsyncCommStage::StagedGroup" ref="bd8193bd78625cb42940385c4982c7b5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class StagedGroup<code> [friend]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>source/toolbox/parallel/<a class="el" href="AsyncCommStage_8h.html">AsyncCommStage.h</a><li>source/toolbox/parallel/<a class="el" href="AsyncCommStage_8C.html">AsyncCommStage.C</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Jun 18 11:29:06 2009 for SAMRAI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
