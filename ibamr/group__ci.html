<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IBAMR: Continuous Integration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IBAMR
   &#160;<span id="projectnumber">IBAMR version 0.19.</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Continuous Integration</div>  </div>
</div><!--header-->
<div class="contents">

<p>Description of <a class="el" href="namespaceIBAMR.html">IBAMR</a>'s Continuous Integration (CI) infrastructure.  
<a href="#details">More...</a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Working with IBAMR's Continuous Integration (CI) setup</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Introduction</h2>
<p>Changes proposed to <a class="el" href="namespaceIBAMR.html">IBAMR</a> need to not introduce new bugs or compilation problems. To this end, <a class="el" href="namespaceIBAMR.html">IBAMR</a> presently uses GitHub actions to, for each pull request, compile the library, all tests and examples, and run a subset of the test suite. For historical reasons we use our own test runner, attest, which understands IBAMR-specific things (like running with MPI and restart files).</p>
<h2><a class="anchor" id="autotoc_md3"></a>
How it works</h2>
<p>In order to compile <a class="el" href="namespaceIBAMR.html">IBAMR</a> we first need a basic computing environment (MPI, compilers, a shell, etc.) as well as <a class="el" href="namespaceIBAMR.html">IBAMR</a>'s dependencies. To this end, all of <a class="el" href="namespaceIBAMR.html">IBAMR</a>'s build dependencies are packaged inside one of several docker containers. These containers provide a portable environment in which we can compile the library with specified precompiled versions of PETSc, <a class="el" href="namespaceSAMRAI.html">SAMRAI</a>, etc. We maintain three different CI configurations:</p><ul>
<li>A newer configuration (based on Arch Linux) with reasonably recent versions of dependencies</li>
<li>The oldest supported version of Ubuntu</li>
<li>macOS</li>
</ul>
<p>The file specifying what GitHub does is <code>.github/workflows/push-pull.yml</code>. This YAML file specifies what each virtual machine (hosted by GitHub) should do when a new pull request is created. This file is responsible for setting up the environment for compiling the library: in particular, it pulls down David Wells' Docker images from DockerHub to get copies of all recent dependencies.</p>
<p>Scripts for compiling docker images are available at</p>
<p><a href="https://github.com/IBAMR/docker-files">https://github.com/IBAMR/docker-files</a></p>
<h2><a class="anchor" id="autotoc_md4"></a>
Improving performance with ccache</h2>
<p><a class="el" href="namespaceIBAMR.html">IBAMR</a> takes upwards of an hour to compile on one of GitHub's virtual cloud machines. Most of this time is spent compiling the same files between runs. To accelerate this process, we use GitHub's cache action (<code>actions/cache</code>) which stores build artifacts between runs. To speed up compilation, ccache will run the C preprocessor on each file and hash the result: if the hash matches a cache entry, then ccache returns that value (an object file) instead of running the compiler itself. This lowers compilation time by about 80%.</p>
<p>GitHub's cache infrastructure was not intended to do this. To make things work, we rebuild the cache on the master branch after merges and pull that into feature branches. Feature branches cannot access caches from other feature branches.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Actually compiling the library and running the test suite</h2>
<p>For more information see the actual Dockerfiles: we use them, plus the copies of ccache and ninja in the container, to run attest. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
